<!DOCTYPE html>
<!-- JG Reveal.js Template --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="pandoc">
<meta name="author" content="Jonathan Magnolia Gilligan">
<title>Theory of Monte-Carlo Analysis</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimal-ui">
<link rel="stylesheet" href="../../lecture_lib/library/reveal.js-3.8.0/css/reset.css">
<link rel="stylesheet" href="../../lecture_lib/library/reveal.js-3.8.0/css/reveal.min.css">
<style type="text/css">
      code{white-space: pre-wrap;}
      .smallcaps{font-variant: small-caps;}
      .line-block{white-space: pre-line;}
      .column{display: inline-block;}  </style>
<style type="text/css">
    div.qrbox,
    aside.qrbox {
     text-align: left;
     vertical-align: bottom;
     width: 95%;
     position: fixed;
     left: 2.5%;
     bottom: 1rem;
     display: block;
    }
  </style>
<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { font-weight: bold; } /* Alert */
code span.an { font-style: italic; } /* Annotation */
code span.cf { font-weight: bold; } /* ControlFlow */
code span.co { font-style: italic; } /* Comment */
code span.cv { font-style: italic; } /* CommentVar */
code span.do { font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.er { font-weight: bold; } /* Error */
code span.in { font-style: italic; } /* Information */
code span.kw { font-weight: bold; } /* Keyword */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.wa { font-style: italic; } /* Warning */
  </style>
<!-- theme = solarized_jg --><link rel="stylesheet" href="../../lecture_lib/library/assets/css/theme/solarized_jg.css" id="theme">
<!-- Printing and PDF exports --><script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? '../../lecture_lib/library/reveal.js-3.8.0/css/print/pdf.css' : '../../lecture_lib/library/reveal.js-3.8.0/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script><!--[if lt IE 9]>
  <script src="../../lecture_lib/library/reveal.js-3.8.0/lib/js/html5shiv.js"></script>
  <![endif]--><script src="../../lecture_lib/library/header-attrs-2.30.1.9000/header-attrs.js"></script>
</head>
<body>
  <div class="reveal">
    <div class="slides">

            <!-- start title slide -->
<section class="center" id="title"><h1 class="title">Theory of Monte-Carlo Analysis</h1>
    <h3 class="author">EES 4891-06/5891-01</h3>
        <h3 class="author">Bayesian Statistical Methods</h3>
    <h3 class="author">Jonathan Magnolia Gilligan</h3>
    <h3 class="date">
      Class #11:
       Wednesday February 18,
      2026
    </h3>
	<!-- end title slide -->
</section><section><section id="continuous-interactions" class="title-slide slide level1 center"><h1 class="center">Continuous Interactions</h1>

</section><section id="a-winter-flower" class="slide level2 eighty"><h2 class="eighty">A Winter Flower</h2>
<div class="columns">
<div class="column textleft">
<ul>
<li>Tulips grown in greenhouses
<ul>
<li>Soil</li>
<li>Light</li>
<li>Water</li>
</ul>
</li>
</ul>
<div class="bare max-listing mtop-1">
<div class="sourceCode" id="cb1"><pre class="sourceCode r seventy max-listing bare"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(tulips)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> tulips</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tulips)</span></code></pre></div>
<pre class="seventy max-listing"><code>##   bed water shade blooms
## 1   a     1     1   0.00
## 2   a     1     2   0.00
## 3   a     1     3 111.04
## 4   a     2     1 183.47
## 5   a     2     2  59.16
## 6   a     2     3  76.75</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r seventy max-listing bare"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(tulips<span class="sc">$</span>bed)</span></code></pre></div>
<pre class="seventy max-listing"><code>## [1] "a" "b" "c"</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r seventy max-listing bare"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>( </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">blooms_std =</span> blooms <span class="sc">/</span> <span class="fu">max</span>(blooms),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">water_cent =</span> water <span class="sc">-</span> <span class="fu">mean</span>(water),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">shade_cent =</span> shade <span class="sc">-</span> <span class="fu">mean</span>(shade)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
</div>
<div class="column textleft">
<ul>
<li class="fragment">Predict <code>blooms</code> from <code>water</code>, and
<code>shade</code>.</li>
<li class="fragment">Two models:
<ul>
<li>
<p><strong>Non-interacting:</strong></p>
<div class="bare max-listing mtop-1">
<div class="sourceCode" id="cb6"><pre class="sourceCode r seventy max-listing bare"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mdl_tulip_non <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    blooms_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bw <span class="sc">*</span> water_cent <span class="sc">+</span> bs <span class="sc">*</span> shade_cent,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="fl">0.5</span>, <span class="fl">0.25</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    bw <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    bs <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data=</span>d)</span></code></pre></div>
</div>
</li>
<li>
<p><strong>Interacting:</strong></p>
<div class="bare max-listing mtop-1">
<div class="sourceCode" id="cb7"><pre class="sourceCode r seventy max-listing bare"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mdl_tulip_inter <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    blooms_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma) ,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bw <span class="sc">*</span> water_cent <span class="sc">+</span> bs <span class="sc">*</span> shade_cent <span class="sc">+</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>          bws <span class="sc">*</span> water_cent <span class="sc">*</span> shade_cent,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="fl">0.5</span>, <span class="fl">0.25</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    bw <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    bs <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    bws <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data=</span>d)</span></code></pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
</section><section id="interpreting-the-models" class="slide level2 eighty"><h2 class="eighty">Interpreting the models</h2>
<p><img data-src="assets/fig/plot_cont_inter-1.png"><!-- --></p>
</section></section><section><section id="monte-carlo-analysis" class="title-slide slide level1 center"><h1 class="center">Monte-Carlo Analysis</h1>

</section><section id="the-problem" class="slide level2 eighty"><h2 class="eighty">The Problem</h2>
<ul>
<li>Bayes’s Theorem <span class="math display">\[
\begin{align}
P(\beta | Y, X) &amp;= \frac{P(Y | \beta, X) P(\beta)}{P(Y | X)} \\
                &amp;= \frac{P(Y | \beta, X) P(\beta)}{ \int P(Y |
\beta, X) P(\beta) d\beta}
\end{align}
\]</span>
<ul>
<li>
<span class="math inline">\(\beta\)</span> = the set of parameters
for model (a vector)</li>
<li>
<span class="math inline">\(Y\)</span> = all the observed values of
the outcome variable (a vector)</li>
<li>
<span class="math inline">\(X\)</span> = all the observed values of
the predictor variables (an array)</li>
<li>
<span class="math inline">\(P(Y | \beta, X)\)</span> =
<em>likelihood</em> for <em>Y</em> (e.g., <span class="math inline">\(Y
\sim \text{Normal}(\beta x, \sigma)\)</span>)</li>
<li>
<span class="math inline">\(P(\beta)\)</span> = <em>prior</em> for
<span class="math inline">\(\beta\)</span>
</li>
<li>
<span class="math inline">\(P(Y | X)\)</span> =
<em>evidence</em>
</li>
</ul>
</li>
<li>All of these terms are super-easy to calculate except the
<em>evidence</em> term: <span class="math display">\[\int P(Y | \beta,
X) P(\beta) d\beta\]</span>
</li>
</ul></section><section id="calculating-the-evidence" class="slide level2 eighty"><h2 class="eighty">Calculating the <em>Evidence</em>
</h2>
<ul>
<li>For a few simple cases, you can solve the integral analytically</li>
<li class="fragment">For most cases, there is not a simple solution</li>
<li class="fragment">Numerical integration:
<ul>
<li>Approximate the integral</li>
<li class="fragment">Grid sampling (Chapters 2–3):
<ul>
<li class="fragment">You need many points on the grid (typically a few hundred to
several thousand) to make sure you don’t miss important features of the
prior &amp; likelihood.</li>
<li class="fragment">Works for 1 and 2 dimensional problems, if the prior and
likelihood are sufficiently smooth.</li>
<li class="fragment">For many dimensions (many parameters), it becomes
computationally crazy.
<ul>
<li>10 parameters, grid with 100 points along each dimension:
100<sup>10</sup> = 10<sup>20</sup> points.
<ul>
<li>If it takes one microsecond to calculate each grid point, then it
would take more than 3 million years to calculate the whole grid.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul></section><section id="monte-carlo-sampling" class="slide level2 eighty"><h2 class="eighty">Monte Carlo Sampling</h2>
<div class="columns">
<div class="column">
<ul>
<li>Nuclear bomb research, 1940s:
<ul>
<li>The problem: Calculating diffusion of neutrons in the core of a
thermonuclear bomb.</li>
</ul>
</li>
<li class="fragment" data-fragment-index="1">Integrals were too hard for the best mathematicians</li>
<li class="fragment" data-fragment-index="2">Grid sampling was unfeasible
<ul>
<li>No electronic computers</li>
<li>“Computers” referfed to dozens of women using slide-rules and
mechanical calculators to solve complex mathematical problems</li>
</ul>
</li>
<li class="fragment" data-fragment-index="3">Stanislaw Ulam: Instead of a regular grid, pick a bunch of
random numbers.
<ul>
<li>John von Neumann and Nicholas Metropolis made important
contributions.</li>
</ul>
</li>
</ul>
</div>
<div class="column">
<div class="fragment" data-fragment-index="2">
<h3 id="computers-1943">Computers (1943)</h3>
<div class="bare">
<p><img data-src="assets/images/1940s-computers.jpg" height="375"></p>
<div class="credit">
<p>Source: <a href="https://images.nasa.gov/search?q=ARC-1943-AAL-4961&amp;page=1&amp;media=image,video,audio&amp;yearStart=1920&amp;yearEnd=2026">NASA
Ames Research Center</a>, Photo ARC-1943-AAL-4961. Public Domain</p>
</div>
</div>
</div>
<div class="fragment" data-fragment-index="3">
<h3 id="stanislaw-ulam">Stanislaw Ulam</h3>
<div class="bare">
<p><img data-src="assets/images/STAN_ULAM_HOLDING_THE_FERMIAC.jpg" height="400"></p>
<div class="credit">
<p>Source: <a href="https://commons.wikimedia.org/wiki/File:STAN_ULAM_HOLDING_THE_FERMIAC.jpg">Wikipedia</a>,
Public Domain</p>
</div>
</div>
</div>
</div>
</div>
</section><section id="origin-of-monte-carlo-integration" class="slide level2 seventyfive"><h2 class="seventyfive">Origin of Monte-Carlo Integration</h2>
<div class="textleft">
<blockquote>
<p>The first were suggested by a question which occurred to me in 1946
as I was convalescing from an illness and playing solitaires. The
question was what are the chances that a Canfield solitaire laid out
with 52 cards will come out successfully? Whether a more practical
method than “abstract thinking” might not be to lay it out say one
hundred times and simply observe and count the number of successful
plays.</p>
<p>This was already possible to envisage with the beginning of the new
era of fast computers, and I immediately thought of problems of neutron
diffusion and other questions of mathematical physics, and more
generally how to change processes described by certain differential
equations into an equivalent form interpretable as a succession of
random operations.</p>
<p>— Stanislaw Ulam</p>
</blockquote>
</div>
</section><section id="simple-illustration" class="slide level2 eighty"><h2 class="eighty">Simple Illustration</h2>
<div class="columns">
<div class="column" style="width:65%;">
<ul>
<li>Estimate the area of a circle
<ul>
<li class="fragment" data-fragment-index="1">Draw a square 1 inch by 1 inch</li>
<li class="fragment" data-fragment-index="2">Inscribe a circle 1 inch in diameter</li>
<li class="fragment" data-fragment-index="3">Throw a dart at the paper many times</li>
<li class="fragment" data-fragment-index="4">Count the number of times the dart lands inside the circle and
the number it lands anywhere inside the square <span class="math display">\[\frac{\# \text{in circle}}{\# \text{in square}} =
\frac{\text{area of circle}}{\text{area of square}}\]</span>
</li>
<li class="fragment" data-fragment-index="5">200 throws land in the square. 165 land inside the circle.
<ul>
<li>The ratio is 0.825.</li>
<li>The exact area of the circle is 0.785 in<sup>2</sup>.</li>
<li>The difference is 5.0%</li>
</ul>
</li>
<li class="fragment" data-fragment-index="6">The method works just as well for the area inside any
complicated shape</li>
</ul>
</li>
</ul>
</div>
<div class="column" style="width:34%;">
<div class="bare fragment" data-fragment-index="2">
<p><img data-src="assets/fig/plot-circle-1.png"><!-- --></p>
</div>
<div class="bare fragment" data-fragment-index="4">
<p><img data-src="assets/fig/plot-circle-mc-1.png"><!-- --></p>
</div>
</div>
</div>
</section><section id="monte-carlo-for-bayesian-analysis" class="slide level2 eighty"><h2 class="eighty">Monte-Carlo for Bayesian Analysis</h2>
<div class="columns">
<div class="column">
<ul>
<li>Monte-Carlo:
<ul>
<li>If you have <em>n</em> <em>parameters</em> (<span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\beta_2\)</span>, <span class="math inline">\(\beta_3\)</span>, …, <span class="math inline">\(\beta_n\)</span>):
<ol type="1">
<li>Draw <em>n</em> random numbers <span class="math inline">\(\beta_{i,1}\)</span>, <span class="math inline">\(\beta_{i,2}\)</span>, …, <span class="math inline">\(\beta_{i,n}\)</span>:
<ul>
<li>each is a potential value for a <em>parameter</em>
</li>
<li>Together, they represent one point in the <em>n</em>-dimensional
<em>parameter space</em> <span class="math inline">\(\beta_i =
(\beta_{i,1}, \beta_{i,2}, \ldots, \beta_{i,n})\)</span>
</li>
</ul>
</li>
<li>Calculate <em>prior</em> <span class="math inline">\(P(\beta_i)\)</span> and <em>likelihood</em> <span class="math inline">\(P(Y | \beta_i, X)\)</span>
</li>
<li>Repeat many times for <span class="math inline">\(i = 1\)</span> to
<span class="math inline">\(i = N_{\text{samples}}\)</span>
<ul>
<li>Generate <span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\beta_2\)</span>, …, <span class="math inline">\(\beta_{N_{\text{samples}}}\)</span>
</li>
<li>Typically <span class="math inline">\(N_{\text{samples}}\)</span> is
several thousand</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ul>
</div>
<div class="column">
<ul>
<li class="fragment">For any point <span class="math inline">\(\beta\)</span> in
parameter space, the posterior for <span class="math inline">\(\beta\)</span> is <span class="math display">\[
P(\beta | Y, X) =
     \frac{ P(Y | \beta, X) P(\beta) }
          { \sum_{i=1}^{N_{\text{samples}}} P(Y | \beta_i, X)
P(\beta_i)} \]</span>
</li>
<li class="fragment">The bigger <em>n</em> is, the more samples you need.
<ul>
<li>For high <em>n</em>, this can become very large, computationally
hard.</li>
</ul>
</li>
<li class="fragment">Can we find a smarter way to pick random numbers?
<ul>
<li class="fragment">What does it mean to be smart about randomness?</li>
</ul>
</li>
<li class="fragment">Markov-Chain Monte Carlo:
<ul>
<li>The probability distribution for the <em>next</em> random number
depends on the <em>last</em> one.</li>
</ul>
</li>
</ul>
</div>
</div>
</section></section><section><section id="markov-chain-monte-carlo" class="title-slide slide level1 center"><h1 class="center">Markov-Chain Monte Carlo</h1>

</section><section id="metropolis-algorithm" class="slide level2 eighty"><h2 class="eighty">Metropolis Algorithm</h2>
<div class="columns">
<div class="column bare" style="width:60%;">
<ul>
<li class="fragment">Start with a random value for the parameter <span class="math inline">\(\beta_1\)</span>
</li>
<li class="fragment">To pick the next value <span class="math inline">\(\beta_{i+1}\)</span>, from a current value <span class="math inline">\(\beta_i\)</span>:
<ol type="1">
<li class="fragment">
<p>Toss a coin.</p>
<ul>
<li>
<strong>Heads:</strong> your proposed new value <span class="math inline">\(\beta'\)</span> is a random number greater
than <span class="math inline">\(\beta_i\)</span>.</li>
<li>
<strong>Tails:</strong> your proposed new value <span class="math inline">\(\beta'\)</span> is a random number less than
<span class="math inline">\(\beta_i\)</span>.</li>
</ul>
</li>
<li class="fragment">
<p>Calculate</p>
<p><span class="math display">\[
\begin{align}
q  &amp;= \text{likelihood}(Y | \beta_i, X) \times \text{prior}(\beta_i)
\\
q' &amp;= \text{likelihood}(Y | \beta', X) \times
\text{prior}(\beta')
\end{align}
\]</span></p>
</li>
<li class="fragment"><p>If <span class="math inline">\(q' &gt; q\)</span>, set
<span class="math inline">\(\beta_{i+1} =
\beta_{\text{test}}\)</span></p></li>
<li class="fragment">
<p>Otherwise, pick a random number <span class="math inline">\(r\)</span> between 0 and 1.</p>
<ul>
<li>If <span class="math inline">\(r \le q' / q\)</span> then set
<span class="math inline">\(\beta_{i+1} = \beta'\)</span>
</li>
<li>Otherwise, reject the proposal and set <span class="math inline">\(\beta_{i+1} = \beta_i\)</span>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</div>
<div class="column" style="width:39%;">
<ul>
<li class="fragment">This guarantees that you visit points where the posterior is
greater more often than points where the posterior is small
<ul>
<li>The frequency of visiting a point is proportional to the posterior
at that point</li>
</ul>
</li>
<li class="fragment">If the posterior is relatively smooth, and only has one maximum,
and is very small over most of <em>parameter space</em>, then you can
estimate the integral by only looking at a small part of <em>parameter
space</em>, where the posterior is significantly greater than zero.</li>
</ul>
</div>
</div>
</section><section id="gibbs-sampling" class="slide level2 eighty"><h2 class="eighty">Gibbs Sampling</h2>
<ul>
<li>Metropolis sampling:
<ul>
<li>
<strong>Symmetric:</strong> The probability of choosing a proposal
to go from <span class="math inline">\(\beta_1\)</span> to <span class="math inline">\(\beta_2\)</span> is the same a proposal to go from
<span class="math inline">\(\beta_2\)</span> to <span class="math inline">\(\beta_1\)</span>.</li>
<li>
<strong>Random:</strong> You don’t use any information about what
you know about the posterior to choose the next point.</li>
</ul>
</li>
<li>Gibbs Sampling:
<ul>
<li>
<strong>Asymmetric</strong> and <strong>adaptive:</strong> Makes
smarter proposals that sample the posterior much more efficiently.</li>
<li class="fragment">Cost: You can only use certain kinds of priors, called
<em>conjugate pairs</em>.</li>
<li class="fragment">From 1989 to 2012, Gibbs sampling was the state of the art for
most Bayesian analysis.
<ul>
<li>R package <code>rjags</code>
</li>
</ul>
</li>
</ul>
</li>
</ul></section><section id="limitations-of-metropolis-gibbs" class="slide level2 eighty"><h2 class="eighty">Limitations of Metropolis &amp; Gibbs</h2>
<ul>
<li>Metropolis and Gibbs sampling work very well for small numbers of
parameters (&lt;100 or so)</li>
<li class="fragment">For hundreds or thousands of parameters, they break badly.</li>
<li class="fragment">Even for small numbers of parameters, they break badly when
parameters are highly correlated
<ul>
<li>
<p>(think about height and length of legs, or exercise 6M2)</p>
<div class="columns">
<div class="column">
<p><img data-src="assets/images/metro-corr.png" height="400"></p>
</div>
<div class="column">
<ul>
<li>Samples don’t uniformly fill high-probability region
<ul>
<li>X = starting point (<span class="math inline">\(\beta_1\)</span>)</li>
<li>Solid = accepted proposals</li>
<li>Hollow = rejected proposals</li>
</ul>
</li>
</ul>
</div>
</div>
</li>
</ul>
</li>
<li class="fragment">The problem is that these algorithms only look along a few
directions at a time, and with high dimensions, they may not be looking
in the most interesting direction, so they keep poking around in the
dark, not looking at where the interesting stuff is.</li>
</ul></section></section><section><section id="hamiltonian-monte-carlo" class="title-slide slide level1 center"><h1 class="center">Hamiltonian Monte Carlo</h1>

</section><section id="simple-vs.-complex-monte-carlo" class="slide level2"><h2>Simple vs. Complex Monte Carlo</h2>
<ul>
<li>Metropolis and Gibbs make simple proposals.
<ul>
<li class="fragment">The computational cost of making a proposal is small</li>
<li class="fragment">The quality of the proposals is also small</li>
<li class="fragment">For simple problems, you don’t need high-quality proposals.</li>
<li class="fragment">For complex problems, low-quality proposals waste time and the
algorithm spins its wheels.</li>
</ul>
</li>
<li class="fragment">Hamiltonian Monte Carlo (HMC)
<ul>
<li class="fragment">Proposals are costly</li>
<li class="fragment">But their quality is much greater</li>
<li class="fragment">For complex problems, HMC finds solutions much faster.</li>
<li class="fragment">For many years, HMC wasn’t very useful because you had to write
custom code and there were many options to control the performance, and
no one knew how to adjust the options effectively.</li>
</ul>
</li>
</ul></section><section id="stan" class="slide level2 eighty"><h2 class="eighty">Stan</h2>
<ul>
<li>In 2012, the <code>stan</code> program changed everything:
<ul>
<li class="fragment">The developers figured out how to adjust the HMC options
effectively and automatically</li>
<li class="fragment"><code>Stan</code> lets you write your model in a simple
programming language and translates it to efficient <code>c++</code>,
which is compiled and runs very fast.</li>
<li class="fragment">Now R packages like <code>rethinking</code> and
<code>brms</code> let you specify the model in <code>R</code> and
translates it to the <code>stan</code> language, and <code>stan</code>
then translates it to <code>c++</code> and turns it into a program.</li>
</ul>
</li>
</ul></section><section id="hamiltonian-monte-carlo-carlo" class="slide level2 eighty"><h2 class="eighty">Hamiltonian Monte Carlo Carlo</h2>
<ul>
<li>Hamiltonian Monte Carlo uses a physics simulation to do statistical
calculations
<ul>
<li class="fragment">Think of graphs of probability as hills and valleys
<ul>
<li>The elevation is the logarithm of the posterior probability
density</li>
</ul>
</li>
<li class="fragment">Consider your Monte Carlo sampling point like a ball rolling on
the landscape
<ol type="1">
<li class="fragment">Pick a starting point and put the ball there.</li>
<li class="fragment">Flick the ball in a random direction with a random velocity</li>
<li class="fragment">Allow the ball to roll over the landscape for some amount of
time</li>
<li class="fragment">Otherwise, after the time is up, wherever the ball is, that’s
your next sample.</li>
</ol>
</li>
</ul>
</li>
</ul></section><section id="illustrations-of-hamiltonian-monte-carlo" class="slide level2 eighty"><h2 class="eighty">Illustrations of Hamiltonian Monte Carlo</h2>
<div class="columns">
<div class="column" style="width:60%;">
<h3 id="hamiltonian-monte-carlo-1">Hamiltonian Monte Carlo</h3>
<div class="bare mtop-1">
<p><img data-src="assets/images/king-monty.png" height="500"></p>
</div>
<ul>
<li>Horizontal lines are elevation contours</li>
<li>Bottom of the valley at 0: uphill to North and South.</li>
<li>Thickness of the line is momentum (speed)
<ul>
<li>Ball slows down as it moves uphill</li>
<li>Ball speeds up as it moves downhill</li>
<li>Within any trajectory:
<ul>
<li>Slower speed, more time at high altitude.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="column fragment" style="width:39%;">
<h3 id="metropolis-monte-carlo">Metropolis Monte Carlo</h3>
<div class="bare mtop-1">
<p><img data-src="assets/images/king-markov.png" height="500"></p>
</div>
<ul>
<li>Much greater autocorrelation among samples</li>
</ul>
</div>
</div>
</section><section id="illustrations-of-hamiltonian-monte-carlo-1" class="slide level2 eighty"><h2 class="eighty">Illustrations of Hamiltonian Monte Carlo</h2>
<div class="columns">
<div class="column">
<ul>
<li>X = start, solid = accepted proposal, hollow = rejected
proposal</li>
<li>Top: Uncorrelated parameters
<ul>
<li>Top left: Well-tuned HMC
<ul>
<li>Samples are far apart, uncorrelated</li>
</ul>
</li>
<li class="fragment">Top right: Poorly-tuned HMC
<ul>
<li>Samples are close together because “rolling ball” made U-turns</li>
<li>Stan has a “No U-Turn Sampler” (NUTS) to avoid this.</li>
</ul>
</li>
</ul>
</li>
<li class="fragment">Bottom: Highly correlated parameters
<ul>
<li>Lower left: HMC samples the space effectively, with little
autocorrelation</li>
<li class="fragment">Lower right: Only one proposal was rejected.
<ul>
<li>Effectively explores the space and quickly finds the maximum.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="column">
<div class="bare mtop-1">
<p><img data-src="assets/images/hmc.png" alt="Hamiltonian Monte Carlo Samples"></p>
</div>
</div>
</div>
</section><section id="limitations-of-hmc" class="slide level2 eighty"><h2 class="eighty">Limitations of HMC</h2>
<ul>
<li>HMC can only work with priors that have continuous parameters and
are continuously differentiable.</li>
<li class="fragment">Metropolis and Gibbs can solve models with discrete parameters
(integers, categories, etc.)</li>
<li class="fragment">You can usually find workarounds for models with discrete
parameters, but this requires clever thinking</li>
<li class="fragment">HMC can fail and it can be very confusing to figure out
why.</li>
<li class="fragment">But when it works well, HMC is enormously effective and much
faster than Gibbs or Metropolis sampling</li>
</ul></section></section>
</div>
  </div>
  <!--
  <script src="../../lecture_lib/library/reveal.js-3.8.0/js/reveal.js"></script>
  <!-- -->
  <script src="../../lecture_lib/library/reveal.js-3.8.0/js/reveal.min.js"></script><!-- --><script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: false,
        // Display a presentation progress bar
        progress: true,
        // Display the page number of the current slide
        slideNumber: 'c/t',
        // Display the page number of the current slide
        showSlideNumber: 'speaker',
        // Push each slide change to the browser history
        history: true,
        //  Enable hashing slide content to URL
        hash: true,
        // Enable keyboard shortcuts for navigation
        keyboard: true,
        // Enable the slide overview mode
        overview: true,
        // Vertical centering of slides
        center: false,
        // Enables touch navigation on devices with touch input
        touch: true,
        // Turns fragments on and off globally
        fragments: true,
        // Don't separate fragments in PDF rendering
        pdfSeparateFragments: false,
        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,
        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,
        // Stop auto-sliding after user input
        autoSlideStoppable: true,
        // Transition style
        transition: 'slide', // none/fade/slide/convex/concave/zoom
        // Transition speed
        transitionSpeed: 'default', // default/fast/slow
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom
        // Number of slides away from the current that are visible
        viewDistance: 3,
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1920,
        height: 1080,
      
        // Optional reveal.js plugins
        dependencies: [
                    { src: '../../lecture_lib/library/assets/plugin/chalkboard/chalkboard.js', async: true },
                                        { src: '../../lecture_lib/library/assets/plugin/reveal-skip-fragments/skip-fragments.js', async: true },
                    { src: '../../lecture_lib/library/reveal.js-3.8.0/plugin/zoom-js/zoom.js', async: true },
          { src: '../../lecture_lib/library/reveal.js-3.8.0/plugin/notes/notes.js', async: true },
          { src: '../../lecture_lib/library/reveal.js-3.8.0/plugin/math/math.js', async: true }
        ],
        shift_keyboard: {
    	    67: function() { RevealChalkboard.toggleNotesCanvas() },	// toggle notes canvas when 'C' is pressed
    	    66: function() { RevealChalkboard.toggleChalkboard() },	  // toggle chalkboard when 'B' is pressed
    	    88: function() { RevealChalkboard.clear() },	            // clear chalkboard when 'X' is pressed
    	    82: function() { RevealChalkboard.reset() },	            // reset chalkboard data on current slide when 'R' is pressed
    	    68: function() { RevealChalkboard.download() },	          // downlad recorded chalkboard drawing when 'D' is pressed
        },
              	// Shortcut for showing all fragments
      	skipFragmentsShowShortcut: 'S',

      	// Shortcut for hiding all fragments
      	skipFragmentsHideShortcut: 'H',
      	      });
    </script><script>
  	function createSingletonNodejg( container, tagname, classname, innerHTML ) {

		// Find all nodes matching the description
		var nodes = container.querySelectorAll( '.' + classname );

		// Check all matches to find one which is a direct child of
		// the specified container
		for( var i = 0; i < nodes.length; i++ ) {
			var testNode = nodes[i];
			if( testNode.parentNode === container ) {
				return testNode;
			}
		}

		// If no node was found, create it now
		var node = document.createElement( tagname );
		node.className = classname;
		if( typeof innerHTML === 'string' ) {
			node.innerHTML = innerHTML;
		}
		container.appendChild( node );

		return node;

	}

  var dom_wrapper = document.querySelector('.reveal');
  createSingletonNodejg(dom_wrapper, 'div', 'qrbox',
  '<div class="qrbox" id="qrbox" style="font-size:90%;">' + '\n' +
  '<div style="font-size:30%;width:100%;">' + '\n' +
      '<a href="https://ees5891.jgilligan.org/slides/class_11">' +
  	'<img src="qrcode.png" alt="https://ees5891.jgilligan.org/slides/class_11"/>' +
  	'</a>' + '\n' +
	  '</div>' + '\n' +
  '<div style="font-size:30%;width:100%;vertical-align:top;">' + '\n' +
    '<span style="display:inline-block;text-align:left;margin-left:0">' + '\n' +
        'Live web page: <a href="https://ees5891.jgilligan.org/slides/class_11">https://ees5891.jgilligan.org/slides/class_11</a>' + '\n' +
              '<br/>' + '\n' +
        'PDF: <a href="https://ees5891.jgilligan.org/slides/class_11/ees_5891-01_class_11_slides.pdf" target="_blank">https://ees5891.jgilligan.org/slides/class_11/ees_5891-01_class_11_slides.pdf</a>' + '\n' +
          	'</span>' + '\n' +
  	'<span style="display:inline-block;text-align:right;vertical-align:top;position:absolute;right:0;bottom:0;">' + '\n' +
  	  'Navigate slides: next: N or &lt;space&gt;; previous: P or &lt;backspace&gt;<br/>' + '\n' +
  	  'Also: up, down, left, right arrows; overview: o; help: ?' + '\n' +
  	'</span>' + '\n' +
	'</div>' + '\n' +
  '</div>' + '\n'
  );
</script><script>
var MathJax = { jax: ["input/TeX", "output/HTML-CSS"],
                TeX: {extensions: ["color.js", "mhchem.js"],
                Macros: {
                  indep: "\\perp \\!\\!\\! \\perp"
                },
                  },
                "HTML-CSS" : {scale: 100 }};
</script><!-- dynamically load mathjax for compatibility with self-contained --><script type="text/x-mathjax-config">
MathJax.Hub.Register.StartupHook("HTML-CSS Jax Ready",function () {
    var VARIANT = MathJax.OutputJax["HTML-CSS"].FONTDATA.VARIANT;
    VARIANT["normal"].fonts.unshift("MathJax_SansSerif");
	  VARIANT["bold"].fonts.unshift("MathJax_SansSerif-bold");
	  VARIANT["italic"].fonts.unshift("MathJax_SansSerif-italic");
	  VARIANT["-tex-mathit"].fonts.unshift("MathJax_SansSerif-italic");
	});
MathJax.Hub.Register.StartupHook("SVG Jax Ready",function () {
    var VARIANT = MathJax.OutputJax["SVG"].FONTDATA.VARIANT;
    VARIANT["normal"].fonts.unshift("MathJax_SansSerif");
	  VARIANT["bold"].fonts.unshift("MathJax_SansSerif-bold");
	  VARIANT["italic"].fonts.unshift("MathJax_SansSerif-italic");
	  VARIANT["-tex-mathit"].fonts.unshift("MathJax_SansSerif-italic");
	});
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
    displayMath: [ ['$$', '$$'], ['\\[', '\\]'] ],
    processEscapes: true
  }
})
  </script><script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script><script>
  var qrbox = document.querySelector("#qrbox");
  var advance_fragment = 0;

	function isPrintingPDF() {
	  let printing = ( /print-pdf/gi ).test( window.location.search );
	  console.log("printing test: " + printing);
	  return printing;
	}


  if ( qrbox.hasAttribute('qr-box-hide') || Reveal.isOverview() ||
      ! Reveal.isFirstSlide() || isPrintingPDF()) {
    console.log("Initializing");
    console.log("Hiding QR box");
    qrbox.style.visibility="hidden";
    qrbox.style.display="none";
  }

  Reveal.addEventListener('overviewshown', function() {
      console.log("Overview shown");
    console.log("Hiding QR box");
    qrbox.style.visibility="hidden";
    qrbox.style.display="none";
  }, false);

  Reveal.addEventListener('overviewhidden', function() {
    if (Reveal.isFirstSlide() && ! qrbox.hasAttribute('qr-box-hide') &&
        ! isPrintingPDF()) {
      console.log("Overview hidden");
      console.log("Showing QR box");
      qrbox.style.visibility="visible";
      qrbox.style.display="block";
    }
  }, false);

  Reveal.addEventListener('slidechanged', function() {
    console.log("Slide changed...");
    if (Reveal.isFirstSlide() && ! Reveal.isOverview() &&
        ! qrbox.hasAttribute('qr-box-hide') &&
        ! isPrintingPDF()) {
      console.log("Showing QR box");
      qrbox.style.visibility="visible";
      qrbox.style.display="block";
    } else {
      console.log("Hiding QR box");
      qrbox.style.visibility="hidden";
      qrbox.style.display="none";
    }
  }, false);

  Reveal.addEventListener('pdf-ready', function() {
    console.log("hiding qrbox for printing");
    qrbox.style.visibility="hidden";
    qrbox.style.display="none";
    qrbox.setAttribute('qr-box-hide', 'true');
  });

  </script><script>
  Reveal.addEventListener('slidechanged', function() {
    while (advance_fragment > 0) {
      // console.log('advancing fragment');
      Reveal.nextFragment();
      advance_fragment--;
    }
  }, false);

  Reveal.addEventListener('slidechanged', function() {
    if ( Reveal.getCurrentSlide().hasAttribute('data-skip')) {
      // console.log("going to next slide...");
      Reveal.next();
    }
  }, false);

  Reveal.addEventListener('skip_slide', function() {
    Reveal.next();
  }, false);

  Reveal.addEventListener('advance_fragment', function() {
    // console.log("setting advance fragment");
    advance_fragment++;
    }, false);
  </script>
</body>
</html>
